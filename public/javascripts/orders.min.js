"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),function(){var e=exports.products;delete exports.products;var s=!1,t=function(e){var t=e.currentTarget.closest("td"),n=t.closest("tr"),r=n.closest(".modal"),a=n.getAttribute("data-item-index"),d=r.getAttribute("data-order-id");cityssm.confirmModal("Acknowledge Item?","Are you sure you want to mark this item as acknowledged?","Acknowledge","success",function(){cityssm.postJSON("/orders/doAcknowledgeItem",{orderID:d,itemIndex:a},function(e){if(e.success){s=!0;var r=i(e);t.remove(),n.appendChild(r)}})})},n=function(e){var t=e.currentTarget.closest("td"),n=t.closest("tr"),r=n.closest(".modal"),a=n.getAttribute("data-item-index"),d=r.getAttribute("data-order-id");cityssm.confirmModal("Unacknowledge Item?","Are you sure you want to unacknowledge this item?","Unacknowledge","danger",function(){cityssm.postJSON("/orders/doUnacknowledgeItem",{orderID:d,itemIndex:a},function(e){if(e.success){s=!0;var r=i({itemIsAcknowledged:!1});t.remove(),n.appendChild(r)}})})},r=function(e,s){var t=s.formFieldsToSave.find(function(s){return s.formFieldName===e.formFieldName}),n=document.createElement("div");return n.className="block",n.innerHTML="<strong>"+cityssm.escapeHTML(t?t.fieldName:e.formFieldName)+":</strong><br />"+cityssm.escapeHTML(e.fieldValue),n},i=function(e){var s=document.createElement("td");if(s.className="has-text-centered",e.itemIsAcknowledged){s.classList.add("is-success");var r=new Date(e.acknowledgedTime);s.innerHTML="Acknowledged<br />"+cityssm.dateToString(r)+"<br />"+cityssm.escapeHTML(e.acknowledgedUser)+"<br />",(i=document.createElement("button")).className="button is-small is-danger mt-2",i.type="button",i.innerHTML="Unacknowledge",i.addEventListener("click",n),s.appendChild(i)}else{var i;s.classList.add("is-warning"),(i=document.createElement("button")).className="button is-success",i.type="button",i.innerHTML="Acknowledge Item",i.addEventListener("click",t),s.appendChild(i)}return s},a=function(s){var t=e[s.productSKU],n=document.createElement("tr");n.setAttribute("data-item-index",s.itemIndex.toString()),n.insertAdjacentHTML("beforeend",'<th scope="row">'+(t?t.productName:s.productSKU)+"<br />$"+(s.quantity*s.unitPrice).toFixed(2)+"</th>");for(var a=document.createElement("td"),d=0,o=s.fields;d<o.length;d++){var c=o[d],l=r(c,t);a.appendChild(l)}n.appendChild(a);var m=i(s);return n.appendChild(m),n},d=function(e){var t=parseInt(e.currentTarget.getAttribute("data-order-index"),10),n=o[t];cityssm.openHtmlModal("order-view",{onshow:function(e){s=!1,e.setAttribute("data-order-id",n.orderID.toString()),e.getElementsByClassName("order--orderNumber")[0].innerText=n.orderNumber;var t=new Date(n.orderTime);e.getElementsByClassName("order--orderTime")[0].innerText=cityssm.dateToString(t)+" "+cityssm.dateToTimeString(t);var r=e.getElementsByClassName("order--statusMessage")[0];n.orderIsRefunded?(r.classList.add("is-warning"),r.innerHTML='<div class="message-body"><strong>This order has been marked as refunded.</strong></div>'):n.orderIsPaid?(r.classList.add("is-success"),r.innerHTML='<div class="message-body"><p class="has-text-weight-bold">This order has been marked as paid.</p></div>'):(r.classList.add("is-danger"),r.innerHTML='<div class="message-body"><strong>This order has been marked as unpaid.</strong></div>');for(var i=document.getElementsByClassName("order--items")[0],d=0,o=n.items;d<o.length;d++){var c=o[d],l=a(c);i.appendChild(l)}e.getElementsByClassName("order--shippingName")[0].innerText=n.shippingName,e.getElementsByClassName("order--shippingAddress")[0].innerHTML=cityssm.escapeHTML(n.shippingAddress1)+"<br />"+(n.shippingAddress2?cityssm.escapeHTML(n.shippingAddress2)+"<br />":"")+cityssm.escapeHTML(n.shippingCity)+", "+cityssm.escapeHTML(n.shippingProvince)+"<br />"+cityssm.escapeHTML(n.shippingPostalCode)+" &nbsp;"+cityssm.escapeHTML(n.shippingCountry||""),e.getElementsByClassName("order--shippingEmailAddress")[0].innerHTML='<a href="mailto:'+cityssm.escapeHTML(n.shippingEmailAddress)+"?subject=RE: "+cityssm.escapeHTML(n.orderNumber)+'">'+cityssm.escapeHTML(n.shippingEmailAddress)+"</a>",e.getElementsByClassName("order--shippingPhoneNumberDay")[0].innerText=n.shippingPhoneNumberDay,e.getElementsByClassName("order--shippingPhoneNumberEvening")[0].innerText=n.shippingPhoneNumberEvening},onhidden:function(){s&&u()}})},o=null,c=document.getElementById("container--results"),l=function(s,t){var n=document.createElement("a");n.className="panel-block is-block",n.href="#"+s.orderID.toString(),n.setAttribute("data-order-index",t.toString()),n.addEventListener("click",d);var r=new Date(s.orderTime),i="";return i=s.orderIsRefunded?'<span class="tag is-warning">Refunded</span>':s.orderIsPaid?'<span class="tag is-success">Paid</span>':'<span class="tag is-danger">Unpaid</span>',n.innerHTML='<div class="columns is-mobile is-multiline"><div class="column is-narrow is-vcentered"><span class="icon m-2">'+(function(e){for(var s=0,t=e.items;s<t.length;s++)if(!t[s].itemIsAcknowledged)return!1;return!0}(s)?'<i class="fas fa-3x fa-check-square is-success" title="Acknowledged"></i>':'<i class="far fa-3x fa-square" title="Not Acknowledged"></i>')+'</span></div><div class="column"><strong>'+cityssm.escapeHTML(s.orderNumber)+"</strong><br />"+cityssm.dateToString(r)+" "+cityssm.dateToTimeString(r)+' </div><div class="column result--itemPreview"></div><div class="column is-full-mobile is-narrow has-text-right">'+i+"</div></div>",n.getElementsByClassName("result--itemPreview")[0].appendChild(function(s){var t=document.createElement("div"),n=s.items[0],r=e[n.productSKU];if(t.innerHTML=cityssm.escapeHTML(r?r.productName:n.productSKU)+(s.items.length>1?" and "+(s.items.length-1).toString()+" other"+(s.items.length>2?"s":""):"")+"<br />",n.fields.length>0){var i=document.createElement("span");i.className="is-size-7",i.innerText=n.fields.reduce(function(e,s){return e+", "+s.fieldValue},"").substring(2),t.appendChild(i)}return t}(s)),n},m=document.getElementById("form--filters"),u=function(){cityssm.clearElement(c),c.innerHTML='<div class="has-text-centered p-4"><span class="icon"><i class="fas fa-4x fa-spinner fa-pulse" aria-hidden="true"></i></span></div>',cityssm.postJSON("/orders/doGetOrders",m,function(e){o=e.orders,function(){if(0!==o.length){var e=document.createElement("div");e.className="panel has-background-white";for(var s=0;s<o.length;s+=1){var t=l(o[s],s);e.appendChild(t)}cityssm.clearElement(c),c.appendChild(e)}else c.innerHTML='<div class="message is-info"><div class="message-body">There are no orders available that meet your search criteria.</div></div>'}()})};u(),document.getElementById("filter--productSKU").addEventListener("change",u),document.getElementById("filter--orderStatus").addEventListener("change",u),document.getElementById("filter--orderTimeMaxAgeDays").addEventListener("change",u)}();