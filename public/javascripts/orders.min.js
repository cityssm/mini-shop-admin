"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=exports.products;delete exports.products;let s=!1;const t=e=>{const t=e.currentTarget.closest("td"),r=t.closest("tr"),n=r.closest(".modal"),d=r.getAttribute("data-item-index"),o=n.getAttribute("data-order-id");cityssm.confirmModal("Acknowledge Item?","Are you sure you want to mark this item as acknowledged?","Acknowledge","success",()=>{cityssm.postJSON("/orders/doAcknowledgeItem",{orderID:o,itemIndex:d},e=>{if(e.success){s=!0;const n=i(e);t.remove(),r.append(n)}})})},r=e=>{const t=e.currentTarget.closest("td"),r=t.closest("tr"),n=r.closest(".modal"),d=r.getAttribute("data-item-index"),o=n.getAttribute("data-order-id");cityssm.confirmModal("Unacknowledge Item?","Are you sure you want to unacknowledge this item?","Unacknowledge","danger",()=>{cityssm.postJSON("/orders/doUnacknowledgeItem",{orderID:o,itemIndex:d},e=>{if(e.success){s=!0;const e=i({itemIsAcknowledged:!1});t.remove(),r.append(e)}})})},n=(e,s)=>{const t=s.formFieldsToSave.find(s=>s.formFieldName===e.formFieldName),r=document.createElement("div");return r.className="block",r.innerHTML="<strong>"+cityssm.escapeHTML(t?t.fieldName:e.formFieldName)+":</strong><br />"+cityssm.escapeHTML(e.fieldValue),r},i=e=>{const s=document.createElement("td");if(s.className="has-text-centered",e.itemIsAcknowledged){s.classList.add("is-success");const t=new Date(e.acknowledgedTime);s.innerHTML="Acknowledged<br />"+cityssm.dateToString(t)+"<br />"+cityssm.escapeHTML(e.acknowledgedUser)+"<br />";const n=document.createElement("button");n.className="button is-small is-danger mt-2",n.type="button",n.innerHTML="Unacknowledge",n.addEventListener("click",r),s.append(n)}else{s.classList.add("is-warning");const e=document.createElement("button");e.className="button is-success",e.type="button",e.innerHTML="Acknowledge Item",e.addEventListener("click",t),s.append(e)}return s},d=s=>{const t=e[s.productSKU],r=document.createElement("tr");r.dataset.itemIndex=s.itemIndex.toString(),r.insertAdjacentHTML("beforeend",'<th scope="row">'+(t?t.productName:s.productSKU)+"<br />$"+(s.quantity*s.unitPrice).toFixed(2)+"</th>");const d=document.createElement("td");for(const e of s.fields){const s=n(e,t);d.append(s)}r.append(d);const o=i(s);return r.append(o),r},o=()=>{s&&p()},a=e=>{const t=Number.parseInt(e.currentTarget.getAttribute("data-order-index"),10),r=c[t];cityssm.openHtmlModal("order-view",{onshow:e=>{s=!1,e.dataset.orderId=r.orderID.toString(),e.querySelector(".order--orderNumber").textContent=r.orderNumber;const t=new Date(r.orderTime);e.querySelector(".order--orderTime").textContent=cityssm.dateToString(t)+" "+cityssm.dateToTimeString(t);const n=e.querySelector(".order--statusMessage");r.orderIsRefunded?(n.classList.add("is-warning"),n.innerHTML='<div class="message-body"><strong>This order has been marked as refunded.</strong></div>'):r.orderIsPaid?(n.classList.add("is-success"),n.innerHTML='<div class="message-body"><p class="has-text-weight-bold">This order has been marked as paid.</p></div>'):(n.classList.add("is-danger"),n.innerHTML='<div class="message-body"><strong>This order has been marked as unpaid.</strong></div>');const i=document.querySelector(".order--items");for(const e of r.items){const s=d(e);i.append(s)}e.querySelector(".order--shippingName").textContent=r.shippingName,e.querySelector(".order--shippingAddress").innerHTML=cityssm.escapeHTML(r.shippingAddress1)+"<br />"+(r.shippingAddress2?cityssm.escapeHTML(r.shippingAddress2)+"<br />":"")+cityssm.escapeHTML(r.shippingCity)+", "+cityssm.escapeHTML(r.shippingProvince)+"<br />"+cityssm.escapeHTML(r.shippingPostalCode)+" &nbsp;"+cityssm.escapeHTML(r.shippingCountry||""),e.querySelector(".order--shippingEmailAddress").innerHTML='<a href="mailto:'+cityssm.escapeHTML(r.shippingEmailAddress)+"?subject=RE: "+cityssm.escapeHTML(r.orderNumber)+'">'+cityssm.escapeHTML(r.shippingEmailAddress)+"</a>",e.querySelector(".order--shippingPhoneNumberDay").textContent=r.shippingPhoneNumberDay,e.querySelector(".order--shippingPhoneNumberEvening").textContent=r.shippingPhoneNumberEvening},onhidden:o})};let c;const l=document.querySelector("#container--results"),m=(s,t)=>{const r=document.createElement("a");r.className="panel-block is-block",r.href="#"+s.orderID.toString(),r.dataset.orderIndex=t.toString(),r.addEventListener("click",a);const n=new Date(s.orderTime);let i="";return i=s.orderIsRefunded?'<span class="tag is-warning">Refunded</span>':s.orderIsPaid?'<span class="tag is-success">Paid</span>':'<span class="tag is-danger">Unpaid</span>',r.innerHTML='<div class="columns is-mobile is-multiline"><div class="column is-narrow is-vcentered"><span class="icon m-2">'+((e=>{for(const s of e.items)if(!s.itemIsAcknowledged)return!1;return!0})(s)?'<i class="fas fa-3x fa-check-square is-success" title="Acknowledged"></i>':'<i class="far fa-3x fa-square" title="Not Acknowledged"></i>')+'</span></div><div class="column"><strong>'+cityssm.escapeHTML(s.orderNumber)+"</strong><br />"+cityssm.dateToString(n)+" "+cityssm.dateToTimeString(n)+' </div><div class="column result--itemPreview"></div><div class="column is-full-mobile is-narrow has-text-right">'+i+"</div></div>",r.querySelector(".result--itemPreview").append((s=>{const t=document.createElement("div"),r=s.items[0],n=e[r.productSKU];if(t.innerHTML=cityssm.escapeHTML(n?n.productName:r.productSKU)+(s.items.length>1?" and "+(s.items.length-1).toString()+" other"+(s.items.length>2?"s":""):"")+"<br />",r.fields.length>0){const e=document.createElement("span");e.className="is-size-7",e.textContent=r.fields.reduce((e,s)=>e+", "+s.fieldValue,"").slice(2),t.append(e)}return t})(s)),r},u=document.querySelector("#form--filters"),p=()=>{cityssm.clearElement(l),l.innerHTML='<div class="has-text-centered p-4"><span class="icon"><i class="fas fa-4x fa-spinner fa-pulse" aria-hidden="true"></i></span></div>',cityssm.postJSON("/orders/doGetOrders",u,e=>{c=e.orders,(()=>{if(0===c.length)return void(l.innerHTML='<div class="message is-info"><div class="message-body">There are no orders available that meet your search criteria.</div></div>');const e=document.createElement("div");e.className="panel has-background-white";for(const[s,t]of c.entries()){const r=m(t,s);e.append(r)}cityssm.clearElement(l),l.append(e)})()})};p(),document.querySelector("#filter--productSKU").addEventListener("change",p),document.querySelector("#filter--orderStatus").addEventListener("change",p),document.querySelector("#filter--orderTimeMaxAgeDays").addEventListener("change",p)})();